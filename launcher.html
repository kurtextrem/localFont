<!--

localFont's loading script and noscript fallback
================================================

If you want to make any improvements, please submit a pull request.

Originally by Smashing Magazine: https://gist.github.com/hdragomir/8f00ce2581795fd7b1b7

-->

<script type="text/javascript">
(function (window) {
    'use strict'

    if (!window.addEventListener) return window.localFont = { load: function () {} } // IE8 and below, we load .eot via IE special conditions

    var document = window.document,
        nua = navigator.userAgent,
        mobile = /(Android (2|3|4.0|4.1|4.2|4.3))|(Opera (Mini|Mobi))/.test(nua) !== false, // we only check Android and ignore old iPhones (<=4.1, as  only support SVG webfonts and have a global market share of 0%)
        oldAndroid = mobile && nua.indexOf('Chrome') === -1 ? 'ttf' : 'woff' // Android Stock Browser below 4.4 and Opera Mini deliver ttf; woff support is great enough

    function LocalFont() {
        this.localStorage = localStorage('t')
        this.supportsWoff2 = null
    }

    LocalFont.prototype.load = function (url, fontVersion, prefix) {
        prefix = prefix || ''
        var _v = prefix + 'fontVersion', _c = prefix + 'fontCSSCache'

        if (this.localStorage[_v] == fontVersion) // if we have the font in localStorage...
            return injectRawStyle(this.localStorage[_c]) // ...we use it

        url += oldAndroid // add correct file ending

        this.supportsWoff2 = this.supportsWoff2 === null ? supportsWoff2() : this.supportsWoff2
        if (this.supportsWoff2)
            url += '2' // woff2

        // once cached, the css file is stored on the client forever unless
        // the URL below is changed. Any change will invalidate the cache.
        url += '.css?' + fontVersion

        // load stylesheet of the font, as we haven't got it stored
        loadStylesheet(url, function (response) {
            // once we have the content, quickly inject the css rules
            injectRawStyle(response)
            // and cache the text content for further use
            // notice that this overwrites anything that might have already been previously cached
            this.localStorage[_c] = response
            this.localStorage[_v] = fontVersion
        }.bind(this))
    }

    // time to get the actual css file
    function loadStylesheet(url, cb) {
        var xhr = new XMLHttpRequest()
        xhr.open('GET', url, true)
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                cb && cb(xhr.responseText)
            }
        }
        xhr.send()
    }

    // this is the simple utitily that injects the cached or loaded css text
    function injectRawStyle(text) {
        var style = document.createElement('style')
        style.setAttribute('type', 'text/css')
        // add the style element to the DOM before adding styles to it to prevent browser crashes
        document.head.appendChild(style)
        if (style.styleSheet) // IE
            return style.styleSheet.cssText = text
        style.innerHTML = text
    }

    function localStorage(t) {
        try {
            window.localStorage[t] = t
            window.localStorage.removeItem(t)
            return window.localStorage
        } catch (e) {
            return {}
        }
    }

    function supportsWoff2() {
        // Source: https://github.com/filamentgroup/woff2-feature-test
        if (!window.FontFace || typeof window.FontFace !== 'function') return false

        var f = new window.FontFace('t', 'url("data:application/font-woff2;base64,d09GMgABAAAAAADcAAoAAAAAAggAAACWAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABk4ALAoUNAE2AiQDCAsGAAQgBSAHIBtvAcieB3aD8wURQ+TZazbRE9HvF5vde4KCYGhiCgq/NKPF0i6UIsZynbP+Xi9Ng+XLbNlmNz/xIBBqq61FIQRJhC/+QA/08PJQJ3sK5TZFMlWzC/iK5GUN40psgqvxwBjBOg6JUSJ7ewyKE2AAaXZrfUB4v+hze37ugJ9d+DeYqiDwVgCawviwVFGnuttkLqIMGivmDg") format("woff2")', {})
        f.load()['catch'](function () {})

        return f.status === 'loading' || f.status === 'loaded'
    }

    window.localFont = new LocalFont()

    /**
     * FontAwesome
     *
     * @version 5
     */
    window.localFont.load('/on' + window.app.urls.staticPath.split('/on')[1] + 'css/fontawesome/fontawesome-', 5)
}(window));
</script>
<noscript>
  <link rel="stylesheet" href="/font.css">
</noscript>
